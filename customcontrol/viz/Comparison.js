/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/thirdparty/d3"],function(C,a){return C.extend("i2d.qm.inspresults.records1.customcontrol.viz.Comparison",{metadata:{properties:{"data":{type:"object",bindable:"bindable",group:"Data",defaultValue:null},"height":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"50"},"showLabel":{type:"boolean",defaultValue:true}}},renderer:function(r,c){r.write("<div tabindex=\"0\" ");r.writeControlData(c);r.write(">");r.write("</div>");},onAfterRendering:function(){this.height=parseInt(this.getHeight(),10);sap.ui.core.ResizeHandler.register(this,this.handleOnResize);this.oResourceBundle=this.getModel("i18n").getResourceBundle();var c=$("#"+this.getId());var b=c[0].getBoundingClientRect();this.drawGraph(b.width,this.height);},handleOnResize:function(){var c=$("#"+this.oControl.getId());c.html("");this.oControl.drawGraph(this.iWidth,this.oControl.height);},getColorCode:function(c){var o;switch(c){case"Good":o="#61A656";break;case"Error":o="#D32030";break;default:o="#848f94";}return o;},getCharProgressTooltip:function(c,i){var t;switch(c){case"Good":t=this.oResourceBundle.getText("QM_ACCEPTED")+": "+i+"\n";break;case"Error":t=this.oResourceBundle.getText("QM_REJECTED")+": "+i+"\n";break;default:t=this.oResourceBundle.getText("QM_RR_POPOVER_OPEN_CHAR")+": "+i;}return t;},drawGraph:function(w,h){var m=this.getModel();var c=this.getBindingContext();var b=m.getProperty("ChPrgsItems",c);if(b===undefined){b=m.getProperty("ChPrgsItemsByOp",c);}if(b===undefined){b=m.getProperty("ChPrgsItemsByMs",c);}if(b===undefined){b=m.getProperty("MastCharPgItem",c);}if(!b){return;}var e=[];var t=this.oResourceBundle.getText("QM_FIELD_PROGRESS_OF_CHARACTERISTIC")+" ";for(var i=0;i<b.length;i++){var o=m.getProperty("/"+b[i],c);var f=[];var g={};g.color=this.getColorCode(o.color);t+=this.getCharProgressTooltip(o.color,o.count);g.y=parseInt(o.value,10);f.push(g);e.push(f);}$("#"+this.getId()).attr("title",t);var j=e;var s=a.layout.stack();s(j);var x=a.scale.linear().domain([0,a.max(j,function(d){return a.max(d,function(d){return d.y0+d.y;});})]).range([0,w]);var k=h;if(this.getShowLabel()){k=h+20;}var l=a.select("#"+this.getId()).append("svg").attr("width",w).attr("focusable",false).attr("height",k);var n=l.selectAll("g").data(j).enter().append("g").style("fill",function(d,i){for(var i=0;i<d.length;i++){return d[i].color;}});n.selectAll("rect").data(function(d){return d;}).enter().append("rect").attr("x",function(d){return x(d.y0);}).attr("y",0).attr("height",h).attr("width",function(d){if(d.y!==0){d.width=x(d.y-1);return d.width;}else{d.width=x(d.y);return d.width;}});if(h===15){n.selectAll("text").data(function(d){return d;}).enter().append("text").attr("fill","white").attr("class","rangeLabel").attr("x",function(d){return x(d.y0)+x(d.y)/2-8;}).attr("y",parseInt(this.getHeight())/2+4).text(function(d){if(d.width>20){return"";}else{return"";}});}else{n.selectAll("text").data(function(d){return d;}).enter().append("text").attr("fill","white").attr("class","rangeLabel").attr("x",function(d){return x(d.y0)+x(d.y)/2-8;}).attr("y",parseInt(this.getHeight(),10)/2+7).text(function(d){if(d.width>20){return"";}else{return"";}});}if(this.getShowLabel()){n.selectAll("g").data(function(d){return d;}).enter().append("text").attr("class","xLabel").attr("x",function(d){return x(d.y0);}).attr("y",$.proxy(function(d){if(this.getShowLabel()){return this.height+15;}return this.height;},this)).text(function(d){if(d.xLabel&&d.width>68){return d.xLabel;}else{return"";}});}}});});
