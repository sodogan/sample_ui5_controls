/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/util/MockServer"],function(M){"use strict";var m,_="i2d/qm/inspresults/records1/",a=_+"localService/mockdata";return{init:function(){var u=jQuery.sap.getUriParameters(),j=jQuery.sap.getModulePath(a),s=jQuery.sap.getModulePath(_+"manifest",".json"),e="ZCoco_Sflight",E=u.get("errorType"),i=E==="badRequest"?400:500,o=jQuery.sap.syncGetJSON(s).data,b=o["sap.app"].dataSources.mainService,d=o["sap.app"].dataSources,c=jQuery.sap.getModulePath(_+b.settings.localUri.replace(".xml",""),".xml"),f=/.*\/$/.test(b.uri)?b.uri:b.uri+"/",A=b.settings.annotations;m=new M({rootUri:f});var t=this;var g=m._loadMetadata;m._loadMetadata=function(h){var k=g.apply(m,[h]);k=t._transformMetadataXML.apply(t,[k]);m._sMetadata=new XMLSerializer().serializeToString(k);return k;};M.config({autoRespond:true,autoRespondAfter:(u.get("serverDelay")||1000)});m.simulate(c,{sMockdataBaseUrl:j,bGenerateMissingMockData:true});var r=m.getRequests();var R=function(h,k,l){l.response=function(x){x.respond(h,{"Content-Type":"text/plain;charset=utf-8"},k);};};if(u.get("metadataError")){r.forEach(function(h){if(h.path.toString().indexOf("$metadata")>-1){R(500,"metadata Error",h);}});}if(E){r.forEach(function(h){if(h.path.toString().indexOf(e)>-1){R(i,E,h);}});}m.setRequests(r);m.start();jQuery.sap.log.info("Running the app with mock data");A.forEach(function(h){var k=d[h],U=k.uri,l=jQuery.sap.getModulePath(_+k.settings.localUri.replace(".xml",""),".xml");new M({rootUri:U,requests:[{method:"GET",path:new RegExp("([?#].*)?"),response:function(x){jQuery.sap.require("jquery.sap.xml");var n=jQuery.sap.sjax({url:l,dataType:"xml"}).data;x.respondXML(200,{},jQuery.sap.serializeXML(n));return true;}}]}).start();});},getMockServer:function(){return m;},_transformMetadataXML:function(d){var t=d;t=this._addRefConstraint(d,"QM_RR_SRV","InspectionLots",["InspectionLot"],"ComparisonItem",["InspectionLot"]);t=this._addRefConstraint(d,"QM_RR_SRV","InspectionLots",["InspectionLot"],"ComparisonItem",["InspectionLot"]);t=this._addRefConstraint(d,"QM_RR_SRV","InspectionLots",["InspectionLot"],"ComparisonItem",["InspectionLot"]);return t;},_addRefConstraint:function(d,n,p,P,D,b){var A=this._getAssociationDetail(d,n,p,D);var r=this._getRefConstraint(d,A.sFromRoleName,P,A.sToRoleName,b);A.oAssoc.appendChild(r);return d;},_getAssociationDetail:function(d,n,p,D){var A=d.querySelectorAll("Association");for(var i=0;i<A.length;i++){var f=A.item(i).firstElementChild;var t=A.item(i).lastElementChild;if(f.getAttribute("Type")===n+"."+p&&t.getAttribute("Type")===n+"."+D){var o=A.item(i);var F=f.getAttribute("Role");var T=t.getAttribute("Role");break;}}F=jQuery.sap.encodeXML(F);T=jQuery.sap.encodeXML(T);return{oAssoc:o,sFromRoleName:F,sToRoleName:T};},_getRefConstraint:function(d,f,p,t,D){var P=d.createElement("Principal");P.setAttribute("Role",f);for(var i=0;i<p.length;i++){var o=d.createElement("PropertyRef");o.setAttribute("Name",p[i]);P.appendChild(o);}var b=d.createElement("Dependent");b.setAttribute("Role",t);for(i=0;i<D.length;i++){o=d.createElement("PropertyRef");o.setAttribute("Name",D[i]);b.appendChild(o);}var r=d.createElement("ReferentialConstraint");r.appendChild(P);r.appendChild(b);return r;}};});
